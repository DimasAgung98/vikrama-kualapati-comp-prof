<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIKRAMA KULAPATI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="https://i.ibb.co.com/v4GmRjLj/Hitam-Oranye-Lingkaran-Paguyuban-Kelas-Logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #c5a059;
            --blood: #8b0000;
            --dark: #0a0a0a;
            --deep-black: #050505;
        }

        body {
            background-color: var(--dark);
            color: #e5e5e5;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        h1, h2, h3, .font-cinzel {
            font-family: 'Cinzel', serif;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--gold);
            border-radius: 10px;
        }

        /* YouTube Background Styling */
        .video-background-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .video-background-wrapper iframe {
            width: 100vw;
            height: 56.25vw;
            min-height: 100vh;
            min-width: 177.77vh;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Hero Video Overlay */
        .hero-container {
            position: relative;
            height: 100vh;
            width: 100%;
            overflow: hidden;
        }

        .hero-filter {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.75);
            z-index: 1;
            filter: grayscale(50%);
        }

        /* Enhanced 3D Card Effect */
        .card-container {
            perspective: 1500px;
            z-index: 10;
        }

        .card-3d {
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
            background: rgba(10, 10, 10, 0.7);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(197, 160, 89, 0.2);
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .card-3d:hover {
            border-color: var(--gold);
            box-shadow: 0 30px 60px rgba(0,0,0,0.9), 0 0 30px rgba(197, 160, 89, 0.2);
        }

        /* Elements inside card with parallax pop */
        .parallax-element {
            transform: translateZ(60px);
            transform-style: preserve-3d;
        }

        .rank-tag {
            background: linear-gradient(45deg, var(--gold), #f5d7a1);
            color: black;
            font-weight: 900;
            text-transform: uppercase;
            padding: 4px 12px;
            font-size: 0.75rem;
            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .don-glow {
            border: 1.5px solid rgba(197, 160, 89, 0.6);
            box-shadow: 0 0 40px rgba(197, 160, 89, 0.15);
        }

        .don-glow::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, transparent, var(--gold), transparent);
            z-index: -1;
            border-radius: inherit;
            animation: rotate-border 4s linear infinite;
            opacity: 0.5;
        }

        @keyframes rotate-border {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }

        /* Gallery Item Hover */
        .gallery-item {
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(197, 160, 89, 0.1);
            transition: all 0.5s ease;
        }

        .gallery-item img {
            transition: transform 0.7s cubic-bezier(0.2, 1, 0.3, 1);
            filter: grayscale(40%) brightness(80%);
        }

        .gallery-item:hover img {
            transform: scale(1.1);
            filter: grayscale(0%) brightness(100%);
        }

        /* Navigation */
        nav {
            background: rgba(5, 5, 5, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(197, 160, 89, 0.2);
        }

        .nav-link {
            position: relative;
            transition: color 0.3s;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--gold);
            transition: width 0.3s;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        /* Modal Styles */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(8px);
            display: none;
        }

        .modal-overlay.active {
            display: flex;
        }

        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fadeInUp 1s ease forwards;
        }

        @keyframes pulse-grayscale {
            0%, 100% { filter: grayscale(100%) brightness(80%); }
            50% { filter: grayscale(0%) brightness(110%); }
        }

        .animate-pulse-grayscale {
            animation: pulse-grayscale 3s ease-in-out infinite;
        }

        .text-shadow-strong {
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.8);
        }

        /* Admin Action Buttons */
        .admin-actions {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
            z-index: 50;
        }

        .admin-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            background: rgba(0,0,0,0.8);
            border: 1px solid rgba(197, 160, 89, 0.3);
            color: white;
        }

        .admin-btn:hover {
            background: var(--gold);
            color: black;
            border-color: white;
        }

        .btn-delete:hover {
            background: #ff4444;
            border-color: white;
            color: white;
        }

        /* Toast Message */
        #messageBox {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #111;
            border: 1px solid var(--gold);
            padding: 1rem 2rem;
            z-index: 200;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        #messageBox.active {
            transform: translateX(-50%) translateY(0);
        }

        /* Improved MP3 Player UI */
        #musicPlayer {
            position: fixed;
            bottom: 1.5rem;
            left: 1.5rem;
            z-index: 150;
            background: rgba(5, 5, 5, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(197, 160, 89, 0.4);
            padding: 12px 24px;
            display: flex;
            align-items: center;
            gap: 20px;
            border-radius: 50px; /* Pill shape */
            box-shadow: 0 15px 40px rgba(0,0,0,0.8);
            min-width: 320px;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-btn {
            background: none;
            border: none;
            color: var(--gold);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(197, 160, 89, 0.1);
        }

        .player-btn:hover {
            color: white;
            background: var(--gold);
            transform: scale(1.1);
        }

        .music-status-box {
            display: flex;
            flex-direction: column;
            gap: 2px;
            min-width: 80px;
        }

        .music-info-label {
            font-size: 8px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #666;
        }

        #musicStatus {
            font-size: 10px;
            font-weight: 700;
            color: var(--gold);
            letter-spacing: 1px;
        }

        /* Improved Volume Slider */
        .volume-container {
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 1px solid rgba(197, 160, 89, 0.2);
            padding-left: 15px;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 70px;
            height: 3px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            cursor: pointer;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 10px;
            height: 10px;
            background: var(--gold);
            border-radius: 50%;
            transition: transform 0.2s;
            box-shadow: 0 0 10px rgba(197, 160, 89, 0.5);
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.3);
        }

        /* Footer Adjustments */
        footer {
            position: relative;
            z-index: 20;
            padding-bottom: 6rem !important; 
        }

        .social-icon-img {
            width: 24px;
            height: 24px;
            filter: grayscale(100%) brightness(1.5);
            transition: all 0.3s ease;
        }

        .social-icon-img:hover {
            filter: grayscale(0%) brightness(1);
            transform: translateY(-3px);
            drop-shadow: 0 0 8px var(--gold);
        }

        .loading-screen {
            position: fixed;
            inset: 0;
            background: var(--dark);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s;
        }
/* LOGO VK 3D */
  @keyframes rotate3d {
    0% {
        transform: rotateY(0deg);
    }
    100% {
        transform: rotateY(360deg);
    }
}

.animate-rotate-3d {
    animation: rotate3d 3s linear infinite;
    transform-style: preserve-3d;
}

.animate-rotate-3d:hover {
    animation: rotate3d 1s linear infinite; /* Lebih cepat saat hover */
    filter: brightness(1.2); /* Lebih terang */
}

.perspective-1000 {
    perspective: 1000px;
}
    </style>
</head>
<body>

    <!-- Loading Screen -->
    <div id="loader" class="loading-screen">
        <div class="text-center">
            <h2 class="font-cinzel text-2xl text-[#c5a059] animate-pulse uppercase tracking-[0.3em]">Vikrama Kulapati</h2>
            <p class="text-gray-500 text-xs mt-4 tracking-widest">SYNCHRONIZING DATA...</p>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 px-8 py-4 flex justify-between items-center">
        <div class="text-2xl font-black font-cinzel text-[#c5a059] tracking-tighter uppercase">
            VIKRAMA KULAPATI
        </div>
        <div class="hidden md:flex space-x-8 font-cinzel text-sm tracking-widest text-white uppercase">
            <a href="#home" class="nav-link">Home</a>
            <a href="#about" class="nav-link">History</a>
            <a href="#gallery" class="nav-link">Gallery</a>
            <a href="#hierarchy" class="nav-link">Hierarchy</a>
            <button id="adminMainBtn" onclick="handleAdminAuth()" class="nav-link text-[#c5a059] font-bold">Admin</button>
        </div>
        <a href="#" class="flex items-center perspective-1000">
            <img src="https://i.ibb.co.com/h1X1sJPG/vk.png" 
                alt="vk" 
                class="h-16 w-auto transition-all duration-700 animate-rotate-3d">
        </a>
    </nav>

    <!-- Custom Message Box -->
    <div id="messageBox" class="font-cinzel text-sm tracking-widest text-white flex items-center gap-4">
        <span id="messageText">SISTEM AKTIF</span>
        <button onclick="hideMessage()" class="text-[#c5a059] ml-4 hover:text-white">✕</button>
    </div>

    <!-- Improved MP3 Player UI -->
    <div id="musicPlayer">
        <div class="music-status-box font-cinzel">
            <span class="music-info-label">V.K Anthem</span>
            <span id="musicStatus">PAUSED</span>
        </div>
        
        <div class="player-controls">
            <button id="playPauseBtn" onclick="togglePlay()" class="player-btn" title="Play/Pause">
                <svg id="playIcon" width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                <svg id="pauseIcon" class="hidden" width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            </button>
            <button onclick="stopMusic()" class="player-btn" title="Stop">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M6 6h12v12H6z"/></svg>
            </button>
        </div>

        <div class="volume-container">
            <svg width="14" height="14" fill="var(--gold)" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5" oninput="changeVolume(this.value)">
        </div>
        
        <audio id="mainAudio" loop>
            <source src="https://res.cloudinary.com/testingbrok/video/upload/TAHTA_HITAM_Official_Music_Vikrama_Kulapati_ANTHEM_V3_muqeig.mp4" type="audio/mpeg">
        </audio>
    </div>

    <!-- Admin PIN Modal -->
    <div id="pinModal" class="modal-overlay fixed inset-0 z-[100] items-center justify-center p-4">
        <div class="bg-[#111] border border-[#c5a059] p-8 rounded-lg max-w-sm w-full text-center">
            <h3 class="font-cinzel text-xl text-[#c5a059] mb-4 uppercase tracking-widest">Admin Access</h3>
            <p class="text-gray-400 text-sm mb-6">Masukkan PIN Keamanan</p>
            <input type="password" id="pinInput" placeholder="****" class="bg-black border border-gray-800 text-white text-center text-2xl tracking-[1em] w-full p-3 mb-6 focus:border-[#c5a059] outline-none">
            <div class="flex gap-4">
                <button onclick="closeModals()" class="flex-1 border border-gray-700 py-2 hover:bg-gray-900 transition-colors text-sm text-white">BATAL</button>
                <button onclick="verifyPin()" class="flex-1 bg-[#c5a059] text-black font-bold py-2 hover:bg-white transition-colors text-sm">LOGIN</button>
            </div>
        </div>
    </div>

    <!-- Admin Modal -->
    <div id="adminModal" class="modal-overlay fixed inset-0 z-[100] items-center justify-center p-4">
        <div class="bg-[#111] border border-[#c5a059] p-8 rounded-lg max-w-md w-full">
            <h3 id="modalTitle" class="font-cinzel text-xl text-[#c5a059] mb-6 tracking-widest uppercase">Pengelolaan</h3>
            <div class="space-y-4">
                <input type="hidden" id="editId" value="">
                <input type="hidden" id="modalType" value="family">
                
                <div>
                    <label id="labelName" class="text-xs text-gray-500 block mb-1 uppercase tracking-tighter">Nama Lengkap</label>
                    <input type="text" id="itemName" class="w-full bg-black border border-gray-800 p-3 text-white focus:border-[#c5a059] outline-none">
                </div>
                
                <div id="rankContainer">
                    <label id="labelRank" class="text-xs text-gray-500 block mb-1 uppercase tracking-tighter">Jabatan / Kategori</label>
                    <select id="itemRank" class="w-full bg-black border border-gray-800 p-3 text-white focus:border-[#c5a059] outline-none"></select>
                </div>
                
                <div>
                    <label class="text-xs text-gray-500 block mb-1 uppercase tracking-tighter">URL Foto (Link Image)</label>
                    <input type="text" id="itemPhoto" placeholder="https://..." class="w-full bg-black border border-gray-800 p-3 text-white focus:border-[#c5a059] outline-none">
                </div>
                
                <div id="descContainer">
                    <label class="text-xs text-gray-500 block mb-1 uppercase tracking-tighter">Deskripsi Singkat</label>
                    <textarea id="itemDesc" class="w-full bg-black border border-gray-800 p-3 text-white focus:border-[#c5a059] outline-none h-24"></textarea>
                </div>
            </div>
            <div class="flex gap-4 mt-8">
                <button onclick="closeModals()" class="flex-1 border border-gray-700 py-3 hover:bg-gray-900 transition-colors text-white uppercase text-xs tracking-widest">Batal</button>
                <button id="saveBtn" onclick="saveData()" class="flex-1 bg-[#c5a059] text-black font-bold py-3 hover:bg-white transition-colors uppercase tracking-widest text-xs">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Sections -->
    <section id="home" class="hero-container flex items-center justify-center">
        <div class="video-background-wrapper"><div id="hero-youtube-player"></div></div>
        <div class="hero-filter"></div>
        <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-[var(--dark)] z-[2]"></div>
        <div class="absolute text-center z-10 px-4 animate-fade-in">
            <p class="text-[#c5a059] tracking-[0.5em] mb-4 text-sm md:text-base font-cinzel uppercase text-shadow-strong">The Blood Oath of Brotherhood</p>
            <h1 class="text-6xl md:text-9xl font-black mb-6 tracking-tighter text-white text-shadow-strong uppercase">Vikrama Kulapati</h1>
            <p class="max-w-xl mx-auto text-gray-300 text-sm md:text-lg italic font-light text-shadow-strong">"Respect is not asked, it is taken, with blood, loyalty, and fear."</p>
            <div class="mt-10"><a href="#about" class="border border-[#c5a059] text-[#c5a059] px-8 py-3 hover:bg-[#c5a059] hover:text-black transition-all duration-300 shadow-lg font-cinzel text-xs tracking-widest uppercase text-shadow-strong">Discover Our Story</a></div>
        </div>
    </section>

    <section id="about" class="py-24 px-8 bg-[#0d0d0d]">
        <div class="max-w-6xl mx-auto grid md:grid-cols-2 gap-16 items-center">
            <div class="relative">
                <div class="absolute -top-4 -left-4 w-24 h-24 border-t-2 border-l-2 border-[#c5a059]"></div>
                <img src="https://i.ibb.co.com/v4GmRjLj/Hitam-Oranye-Lingkaran-Paguyuban-Kelas-Logo.png" alt="Mafia Story" class="w-full rounded-sm shadow-2xl border border-gray-900 animate-pulse-grayscale">
                <div class="absolute -bottom-4 -right-4 w-24 h-24 border-b-2 border-r-2 border-[#c5a059]"></div>
            </div>
            <div>
                <h2 class="text-4xl font-bold font-cinzel mb-8 text-[#c5a059] uppercase tracking-widest">Our Legacy</h2>
                <div class="space-y-6 text-gray-400 leading-relaxed text-lg text-justify">
                    <p><span class="text-white font-semibold uppercase">Vikrama Kulapati</span> adalah kelompok mafia yang namanya beredar seperti bisikan maut, tidak pernah terlihat jelas, namun selalu meninggalkan rasa takut. Dipimpin oleh Acil Valmores, mereka dikenal sebagai organisasi yang bergerak dalam bayangan, mengendalikan perdagangan gelap, informasi rahasia, dan operasi kriminal besar tanpa pernah tersentuh hukum.</p>
                    <p>Di balik kekejaman mereka, <span class="text-white font-semibold uppercase">Vikrama Kulapati</span> berdiri dengan satu prinsip: loyalitas mutlak kepada pemimpin dan tujuan organisasi. Karena itulah, selama bertahun-tahun, nama mereka tetap hidup sebagai legenda gelap sebuah kekuatan yang tidak terlihat, namun selalu ada dan selalu mengancam dari balik kegelapan.</p>
                    <p class="italic text-[#c5a059]">"Respect is earned, loyalty is sworn, silence is eternal."</p>
                </div>
            </div>
        </div>
    </section>

    <section id="gallery" class="py-24 px-8 relative" style="background-image: url('https://i.ibb.co.com/kbhMj0r/Untitled-design-1.png'); background-size: cover; background-position: center;">
    <!-- Tambahkan overlay gelap agar teks tetap terbaca -->
    <div class="absolute inset-0 bg-black/70 -z-10"></div>
    
    <div class="max-w-7xl mx-auto text-center mb-16 relative z-10">
        <h2 class="text-5xl font-bold font-cinzel mb-4 tracking-tight uppercase">Game Gallery</h2>
        <div class="w-24 h-1 bg-[#c5a059] mx-auto mb-6"></div>
        <div id="galleryAdminControls" class="hidden mb-12">
            <button onclick="prepareAdd('gallery')" class="bg-[#c5a059] text-black px-8 py-3 text-xs font-bold hover:bg-white transition-colors uppercase tracking-[0.2em] rounded-sm">Tambah Foto Galeri</button>
        </div>
        <div id="galleryContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </div>
</section>

    <section id="hierarchy" class="py-24 px-8 min-h-screen flex flex-col justify-center bg-[var(--deep-black)]">
        <div class="text-center mb-16">
            <h2 class="text-5xl font-bold font-cinzel mb-4 tracking-tight uppercase">Family Hierarchy</h2>
            <div class="w-24 h-1 bg-[#c5a059] mx-auto mb-10"></div>
            <div id="hierarchyAdminControls" class="hidden mb-12"><button onclick="prepareAdd('family')" class="bg-[#c5a059] text-black px-8 py-3 text-xs font-bold hover:bg-white transition-colors uppercase tracking-[0.2em] rounded-sm">Tambah Anggota Keluarga</button></div>
        </div>
        
        <div id="familyContainer" class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-x-8 gap-y-12 items-start">
            <!-- Data diisi oleh JS -->
        </div>
    </section>

    <footer class="py-16 px-8 border-t border-gray-900 flex flex-col md:flex-row justify-between items-center text-gray-600 text-sm bg-[var(--deep-black)]">
        <div class="font-cinzel text-[#c5a059] font-bold mb-4 md:mb-0 uppercase tracking-widest text-base tracking-tighter">Respect is earned, loyalty is sworn, silence is eternal</div>
        <div class="flex space-x-6 items-center">
            <div class="font-cinzel text-[#c5a059] font-bold mb-4 md:mb-0 uppercase tracking-widest text-base tracking-tighter">Vikrama Kulapati &copy; 2026. All Rights Reserved.</div>
        </div>
    </footer>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, addDoc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBdnTKzLPkKDRHveRtjSNVn4bB1U5yfNAM",
            authDomain: "vikrama-kulapati-web-profile.firebaseapp.com",
            projectId: "vikrama-kulapati-web-profile",
            storageBucket: "vikrama-kulapati-web-profile.firebasestorage.app",
            messagingSenderId: "565873097574",
            appId: "1:565873097574:web:e4a41838be2ab6287f26a7"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = "vikrama-kulapati";

        window.isAdmin = false;
        const ADMIN_PIN = "7411";
        let user = null;

        const hierarchyRank = {
            "THE DON": 1,
            "CAPOREGIME": 2,
            "WACAPO": 3,
            "SOLDIER": 4
        };

        const initFirebase = async () => {
            try {
                await signInAnonymously(auth);
                onAuthStateChanged(auth, (u) => {
                    user = u;
                    if(u) {
                        const loader = document.getElementById('loader');
                        if (loader) {
                            loader.style.opacity = '0';
                            setTimeout(() => loader.style.display = 'none', 500);
                        }
                        setupListeners();
                    }
                });
            } catch (error) {
                console.error("Firebase init error:", error);
            }
        };

        const setupListeners = () => {
            if (!user) return;
            
            const familyRef = collection(db, 'artifacts', appId, 'public', 'data', 'family');
            onSnapshot(familyRef, (snapshot) => {
                const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const sortedData = data.sort((a, b) => {
                    return (hierarchyRank[a.rank] || 99) - (hierarchyRank[b.rank] || 99);
                });
                renderFamily(sortedData);
            });

            const galleryRef = collection(db, 'artifacts', appId, 'public', 'data', 'gallery');
            onSnapshot(galleryRef, (snapshot) => {
                const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderGallery(data);
            });
        };

        window.renderGallery = (items) => {
            const container = document.getElementById('galleryContainer');
            if(!container) return;
            container.innerHTML = '';
            items.forEach((item) => {
                let adminUI = window.isAdmin ? `
                    <div class="admin-actions">
                        <div class="admin-btn" onclick="prepareEdit('gallery', '${item.id}', ${JSON.stringify(item).replace(/"/g, '&quot;')})">✎</div>
                        <div class="admin-btn btn-delete" onclick="deleteItem('gallery', '${item.id}')">✕</div>
                    </div>` : '';
                container.innerHTML += `
                    <div class="gallery-item group relative h-72 rounded-sm cursor-pointer shadow-xl bg-black border border-gray-900">
                        ${adminUI}
                        <img src="${item.photo}" alt="${item.name}" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-500" onerror="this.src='https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=800'">
                        <div class="gallery-overlay absolute inset-0 flex items-end p-6">
                            <div>
                                <p class="text-[#c5a059] text-[10px] font-bold tracking-widest uppercase mb-1">${item.rank}</p>
                                <h4 class="text-white font-cinzel text-lg tracking-widest uppercase text-shadow-strong">${item.name}</h4>
                            </div>
                        </div>
                    </div>`;
            });
        };

        window.renderFamily = (items) => {
            const container = document.getElementById('familyContainer');
            if(!container) return;
            container.innerHTML = '';
            
            items.forEach((member) => {
                let adminUI = window.isAdmin ? `
                    <div class="admin-actions">
                        <div class="admin-btn" onclick="prepareEdit('family', '${member.id}', ${JSON.stringify(member).replace(/"/g, '&quot;')})">✎</div>
                        <div class="admin-btn btn-delete" onclick="deleteItem('family', '${member.id}')">✕</div>
                    </div>` : '';

                const isDon = member.rank === "THE DON";
                const cardClass = isDon ? "md:col-span-4 lg:col-span-4 mx-auto max-w-md don-glow" : "col-span-1";
                const rankDisplay = isDon ? `<div class="flex justify-center mb-2"><span class="rank-tag px-6 py-1 text-sm">THE DON</span></div>` : `<span class="rank-tag">${member.rank}</span>`;

                container.innerHTML += `
                    <div class="card-container ${cardClass}" onmousemove="handleTilt(event, this)" onmouseleave="resetTilt(this)">
                        <div class="card-3d p-8 ${isDon ? 'h-[550px]' : 'h-[450px]'} flex flex-col justify-end rounded-sm overflow-hidden group">
                            ${adminUI}
                            <div class="absolute inset-0 opacity-40 group-hover:opacity-60 transition-opacity bg-cover bg-center grayscale group-hover:grayscale-0 duration-700" style="background-image: url('${member.photo}')"></div>
                            <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"></div>
                            
                            <div class="parallax-element relative z-10 text-center">
                                ${rankDisplay}
                                <h3 class="${isDon ? 'text-4xl md:text-5xl' : 'text-2xl md:text-3xl'} font-bold mt-4 font-cinzel text-white uppercase tracking-widest text-shadow-strong">${member.name}</h3>
                                <div class="h-0 group-hover:h-auto overflow-hidden transition-all duration-500 opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0">
                                    <p class="text-gray-300 text-xs mt-4 tracking-wider leading-relaxed px-4 italic">${member.desc}</p>
                                </div>
                            </div>
                        </div>
                    </div>`;
            });
        };

        window.saveData = async () => {
            const type = document.getElementById('modalType').value;
            const docId = document.getElementById('editId').value;
            const name = document.getElementById('itemName').value;
            const rank = document.getElementById('itemRank').value;
            const photo = document.getElementById('itemPhoto').value;
            const desc = document.getElementById('itemDesc').value;

            if(!name || !user) return;

            const data = { name, rank, photo, desc, updatedAt: Date.now() };
            const colRef = collection(db, 'artifacts', appId, 'public', 'data', type);

            try {
                if(docId) {
                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', type, docId), data);
                    showMessage("DATA DIPERBARUI.");
                } else {
                    await addDoc(colRef, data);
                    showMessage("DATA DITAMBAHKAN.");
                }
                closeModals();
            } catch (e) { showMessage("GAGAL MENYIMPAN."); }
        };

        window.deleteItem = async (type, id) => {
            if(!user || !confirm("Hapus data ini?")) return;
            try {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', type, id));
                showMessage("DATA DIHAPUS.");
            } catch (e) { console.error(e); }
        };

        window.handleAdminAuth = () => {
            if (window.isAdmin) {
                window.isAdmin = false;
                document.getElementById('adminMainBtn').innerText = "ADMIN";
                document.getElementById('galleryAdminControls').classList.add('hidden');
                document.getElementById('hierarchyAdminControls').classList.add('hidden');
                setupListeners();
            } else {
                document.getElementById('pinModal').classList.add('active');
            }
        };

        window.verifyPin = () => {
            if (document.getElementById('pinInput').value === ADMIN_PIN) {
                window.isAdmin = true;
                closeModals();
                document.getElementById('adminMainBtn').innerText = "LOGOUT ADMIN";
                document.getElementById('galleryAdminControls').classList.remove('hidden');
                document.getElementById('hierarchyAdminControls').classList.remove('hidden');
                setupListeners();
                showMessage("AKSES DITERIMA.");
            } else { showMessage("PIN SALAH."); }
        };

        initFirebase();
    </script>

    <!-- Global Video & Music Scripts -->
    <script>
        window.onYouTubeIframeAPIReady = function() {
            new YT.Player('hero-youtube-player', {
                videoId: 'IVn_llDPdLg',
                playerVars: { 
                    'autoplay': 1, 
                    'controls': 0, 
                    'mute': 1, 
                    'loop': 1, 
                    'playlist': 'IVn_llDPdLg',
                    'modestbranding': 1,
                    'showinfo': 0,
                    'rel': 0,
                    'iv_load_policy': 3
                },
                events: {
                    'onReady': (e) => e.target.playVideo()
                }
            });
        };
    </script>
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
        function showMessage(text) {
            const box = document.getElementById('messageBox');
            const textEl = document.getElementById('messageText');
            if (!box || !textEl) return;
            textEl.innerText = text;
            box.classList.add('active');
            setTimeout(hideMessage, 4000);
        }
        function hideMessage() { document.getElementById('messageBox')?.classList.remove('active'); }
        function closeModals() { 
            document.getElementById('pinModal')?.classList.remove('active'); 
            document.getElementById('adminModal')?.classList.remove('active'); 
        }
        function prepareAdd(type) {
            document.getElementById('editId').value = "";
            resetModal(type);
            document.getElementById('adminModal')?.classList.add('active');
        }
        function prepareEdit(type, id, data) {
            resetModal(type);
            document.getElementById('editId').value = id;
            document.getElementById('itemName').value = data.name;
            document.getElementById('itemRank').value = data.rank;
            document.getElementById('itemPhoto').value = data.photo;
            if(type === 'family') document.getElementById('itemDesc').value = data.desc;
            document.getElementById('adminModal')?.classList.add('active');
        }
        function resetModal(type) {
            document.getElementById('modalType').value = type;
            const rankSelect = document.getElementById('itemRank');
            if (!rankSelect) return;
            rankSelect.innerHTML = '';
            if(type === 'family') {
                document.getElementById('descContainer').style.display = 'block';
                ['THE DON', 'CAPOREGIME', 'WACAPO', 'SOLDIER'].forEach(r => rankSelect.innerHTML += `<option value="${r}">${r}</option>`);
            } else {
                document.getElementById('descContainer').style.display = 'none';
                ['Mission', 'Lifestyle', 'Territory'].forEach(c => rankSelect.innerHTML += `<option value="${c}">${c}</option>`);
            }
        }

        const audio = document.getElementById('mainAudio');
        function togglePlay() {
            if (!audio) return;
            if (audio.paused) { 
                audio.play(); 
                document.getElementById('musicStatus').innerText = "PLAYING";
                document.getElementById('playIcon')?.classList.add('hidden');
                document.getElementById('pauseIcon')?.classList.remove('hidden');
            } else { 
                audio.pause(); 
                document.getElementById('musicStatus').innerText = "PAUSED";
                document.getElementById('playIcon')?.classList.remove('hidden');
                document.getElementById('pauseIcon')?.classList.add('hidden');
            }
        }
        function stopMusic() { 
            if (!audio) return;
            audio.pause(); 
            audio.currentTime = 0; 
            document.getElementById('musicStatus').innerText = "STOPPED"; 
        }
        function changeVolume(v) { if (audio) audio.volume = v; }
        document.addEventListener('click', () => { if(audio && audio.paused) audio.play().catch(()=>{}); }, {once: true});

        function handleTilt(e, card) {
            const cardInner = card.querySelector('.card-3d');
            const parallaxItems = card.querySelectorAll('.parallax-element');
            if (!cardInner) return;
            
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            
            const rotateX = (y - centerY) / 10;
            const rotateY = (centerX - x) / 10;
            
            cardInner.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
            
            parallaxItems.forEach(item => {
                item.style.transform = `translateZ(80px) translateX(${(x - centerX) / 15}px) translateY(${(y - centerY) / 15}px)`;
            });
        }

        function resetTilt(card) {
            const cardInner = card.querySelector('.card-3d');
            const parallaxItems = card.querySelectorAll('.parallax-element');
            if(cardInner) cardInner.style.transform = `rotateX(0deg) rotateY(0deg)`;
            parallaxItems.forEach(item => {
                item.style.transform = `translateZ(60px) translateX(0) translateY(0)`;
            });
        }

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if(target) target.scrollIntoView({ behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>

